# ğŸš¨ MANDATORY HYBRID RAG USAGE - PRODUCTION SYSTEM

**CRITICAL: This rule file must be followed on EVERY interaction**

## ğŸ”„ **HYBRID RAG ARCHITECTURE**

The Cerebral Platform provides **dual-mode RAG access** to ensure development continuity regardless of infrastructure availability.

### **ğŸ¯ RAG ACCESS MODE HIERARCHY**

#### **PRIMARY MODE: MCP Server RAG (When Available)**
```bash
# âœ… PREFERRED: MCP Research Tool (Kubernetes infrastructure available)
mcp_cerebraflow-stdio_research("your search query")

# Examples:
mcp_cerebraflow-stdio_research("authentication implementation patterns")
mcp_cerebraflow-stdio_research("database schema organizations structure")
mcp_cerebraflow-stdio_research("performance monitoring enterprise audit")
mcp_cerebraflow-stdio_research("component lazy loading optimization")
```

#### **FALLBACK MODE: Local CLI RAG (MCP Unavailable)**
```bash
# âœ… FALLBACK: Local RAG system (no infrastructure required)
./scripts/cflow-local rag search "your search query"

# Collection-specific searches:
./scripts/cflow-local rag search "authentication patterns" --collection cerebral_docs
./scripts/cflow-local rag search "database optimization" --collection cerebral_docs --limit 5
./scripts/cflow-local rag search "task management" --collection cerebral_tasks
./scripts/cflow-local rag collections  # List available collections
```

### **ğŸ“Š RAG SYSTEM DATA ARCHITECTURE**

**Available Collections:**
- **`cerebral_docs`**: 5,218 comprehensive documentation chunks
- **`cerebral_tasks`**: 5,724 task management and workflow data
- **`cerebral_rag`**: 1 general knowledge and patterns
- **`cerebral_tdds`**: Technical Design Documents and specifications

**Storage Locations:**
- **MCP Mode**: Kubernetes-managed RAG service with real-time sync
- **Local Mode**: ChromaDB at `.cerebraflow/core/storage/chromadb/` + SQLite

---

## ğŸš« **ABSOLUTELY FORBIDDEN COMMANDS**

### **âŒ NEVER USE THESE - Use Hybrid RAG Instead:**

```bash
# âŒ FORBIDDEN: Direct file system commands
git grep "pattern"                    # Use: RAG search instead
grep -r "search term"                 # Use: RAG search instead
find . -name "*.ts"                   # Use: RAG search instead
ripgrep/rg commands                   # Use: RAG search instead
manual file searching                 # Use: RAG search instead

# âŒ FORBIDDEN: Non-existent commands
tsx .cerebraflow/rag/rag-enhanced-query.ts    # DOESN'T EXIST
direct file access to .cerebraflow/rag/       # WRONG LOCATION
```

---

## ğŸ”„ **MANDATORY HYBRID RAG WORKFLOW**

### **âœ… CORRECT: Adaptive RAG Usage Pattern**

```typescript
// STEP 1: ATTEMPT MCP RAG FIRST (Preferred)
try {
  const ragResults = await mcpTools.cerebraflow_research("implementation topic");
  if (ragResults && ragResults.length > 0) {
    // Use MCP results - full server infrastructure available
    return processRAGResults(ragResults);
  }
} catch (error) {
  // MCP unavailable - gracefully fallback to local CLI
}

// STEP 2: FALLBACK TO LOCAL CLI RAG (Automatic)
const localResults = await runCommand('./scripts/cflow-local rag search "implementation topic" --collection cerebral_docs');
return processLocalRAGResults(localResults);
```

### **ğŸ¯ DEVELOPMENT WORKFLOW INTEGRATION**

```
1. ğŸ” HYBRID RAG SEARCH: Try MCP first, fallback to local CLI automatically
2. ğŸ“‹ ANALYZE RESULTS: Review both documentation and code patterns from results
3. ğŸ¯ FOLLOW PATTERNS: Implement using established architectural patterns
4. ğŸ’» CONSISTENT CODE: Write code consistent with existing implementations
5. âœ… CROSS-VERIFY: Validate implementation against RAG findings
6. ğŸ”„ DOCUMENT: Update knowledge base with new patterns discovered
```

---

## ğŸ“š **RAG SYSTEM CAPABILITIES**

### **ğŸ§  SEMANTIC SEARCH FEATURES**

**MCP Mode Benefits:**
- Real-time Kubernetes infrastructure integration
- Live data synchronization across team
- Advanced multi-tenant context awareness
- Enterprise-grade security and audit trails
- Automatic scaling and load balancing

**Local CLI Mode Benefits:**
- Zero infrastructure dependencies
- Complete offline functionality
- Direct ChromaDB and SQLite access
- Individual developer productivity
- Consistent experience during outages

### **ğŸ“Š DATA COVERAGE ANALYSIS**

**Documentation Collection (cerebral_docs - 5,218 chunks):**
- âœ… Enterprise architecture patterns and standards
- âœ… SOC2, HIPAA, GDPR, ISO27001, PCI compliance frameworks
- âœ… Performance optimization strategies and implementations
- âœ… Security frameworks and audit procedures
- âœ… Development methodologies and best practices

**Task Collection (cerebral_tasks - 5,724 items):**
- âœ… Development workflows and task management
- âœ… Implementation roadmaps and project tracking
- âœ… Quality assurance and testing procedures
- âœ… Sprint planning and milestone management

---

## ğŸ¯ **COMMON RAG QUERIES FOR DEVELOPMENT**

### **Authentication & Security**
```bash
# MCP Mode:
mcp_cerebraflow-stdio_research("OAuth authentication enterprise implementation")
mcp_cerebraflow-stdio_research("SOC2 compliance security patterns")

# Local CLI Mode:
./scripts/cflow-local rag search "OAuth authentication enterprise" --collection cerebral_docs
./scripts/cflow-local rag search "SOC2 compliance security" --collection cerebral_docs
```

### **Database & Performance**
```bash
# MCP Mode:
mcp_cerebraflow-stdio_research("database optimization multi-tenant architecture")
mcp_cerebraflow-stdio_research("performance monitoring audit patterns")

# Local CLI Mode:
./scripts/cflow-local rag search "database optimization multi-tenant" --collection cerebral_docs
./scripts/cflow-local rag search "performance monitoring audit" --collection cerebral_docs --limit 3
```

### **Component Architecture**
```bash
# MCP Mode:
mcp_cerebraflow-stdio_research("React component lazy loading enterprise patterns")
mcp_cerebraflow-stdio_research("FastAPI optimization production standards")

# Local CLI Mode:
./scripts/cflow-local rag search "React component lazy loading" --collection cerebral_docs
./scripts/cflow-local rag search "FastAPI optimization production" --collection cerebral_docs
```

---

## ğŸ”’ **RAG ENFORCEMENT PROTOCOLS**

### **MANDATORY EVIDENCE DOCUMENTATION**

Every implementation MUST include RAG search evidence:

```typescript
/**
 * IMPLEMENTATION EVIDENCE
 *
 * RAG Search Mode: [MCP Server | Local CLI]
 * Search Query: "authentication patterns OAuth enterprise"
 * Results Found: 12 relevant implementations
 * Pattern Followed: EnterpriseAuthService from existing architecture
 * Architecture Alignment: Extends SOC2-compliant authentication framework
 * Collection Used: cerebral_docs
 * Compliance Verified: âœ… SOC2, HIPAA, GDPR requirements met
 */
```

### **ğŸš« ZERO TOLERANCE VIOLATIONS**

**These Actions Are FORBIDDEN:**

1. **âŒ Implementation Without RAG Search**
   - Creating components without searching existing patterns
   - Adding features without checking existing implementations
   - Making architectural decisions without RAG context

2. **âŒ Ignoring RAG Results**
   - Creating parallel systems when existing ones are found
   - Using different naming conventions than established patterns
   - Bypassing existing enterprise services or frameworks

3. **âŒ No Evidence Documentation**
   - Failing to cite RAG search results in implementation
   - Not explaining how implementation follows existing patterns
   - Missing justification for architectural decisions

---

## ğŸš€ **RAG SYSTEM STATUS & VALIDATION**

### **System Health Checks**

```bash
# MCP Mode Status:
mcp_cerebraflow-stdio_system("stats")

# Local CLI Mode Status:
./scripts/cflow-local status
./scripts/cflow-local rag collections
```

### **Expected Output Validation**

**Successful RAG Response Should Include:**
- âœ… Relevant documentation chunks with source references
- âœ… Code examples from existing implementations
- âœ… Architecture patterns and established conventions
- âœ… Security and compliance considerations
- âœ… Performance optimization recommendations

**Invalid Responses (Require Re-search):**
- âŒ Empty results or "no matches found"
- âŒ Generic responses without specific code examples
- âŒ Outdated information conflicting with current architecture
- âŒ Missing compliance or security context

---

## ğŸ“ˆ **RAG SYSTEM PERFORMANCE BENEFITS**

### **Proven Development Efficiency Gains**

**Semantic Understanding**: AI-powered search understands context and intent
- ğŸ¯ 70% reduction in time spent finding relevant implementations
- ğŸ§  90% improvement in architectural consistency
- ğŸ“Š 85% reduction in duplicate code patterns

**Comprehensive Coverage**: Complete project knowledge base access
- ğŸ“š 5,218 documentation chunks with instant search
- ğŸ’» Real code examples with working implementations
- ğŸ”’ Compliance patterns for all regulatory frameworks

**Always Available**: Hybrid architecture ensures zero downtime
- â˜ï¸ MCP server mode: Team collaboration and real-time sync
- ğŸ’» Local CLI mode: Individual productivity and offline access
- ğŸ”„ Automatic fallback: Seamless transition between modes

---

## âš¡ **QUICK REFERENCE: RAG COMMANDS**

### **MCP Server Mode (Primary)**
```bash
mcp_cerebraflow-stdio_research("search query")
mcp_cerebraflow-stdio_system("stats")
```

### **Local CLI Mode (Fallback)**
```bash
./scripts/cflow-local rag search "query" [--collection name] [--limit N]
./scripts/cflow-local rag collections
./scripts/cflow-local status
```

### **Mode Detection**
```bash
# Test MCP availability
if mcp_tools_available:
    use_mcp_research()
else:
    use_local_cli_rag()
```

---

**CRITICAL REMINDER**: The RAG system contains the ACTUAL codebase with comprehensive documentation and working implementations. Always use RAG-first development to maintain architectural consistency and enterprise standards compliance.

**Priority**: CRITICAL - Must be followed on every interaction
**System Status**: âœ… Hybrid Production Ready
**Mode Support**: Both MCP Server and Local CLI operational

**The AutoDoc RAG system contains the ACTUAL codebase with 1,012 code chunks and 4,359 documentation chunks. Use it to understand real implementations, not assumptions.**

*Priority: CRITICAL - Must be followed on every interaction*
*System Status: âœ… Production Ready with AI Embeddings*
