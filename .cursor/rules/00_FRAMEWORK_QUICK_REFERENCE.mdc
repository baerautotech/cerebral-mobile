---
description: "Quick reference card for agents - rule precedence and Phase 0 requirements"
globs: "**/*"
alwaysApply: true
priority: 1
---

# âš¡ FRAMEWORK QUICK REFERENCE - AGENTS START HERE

## ðŸŽ¯ BEFORE STARTING ANY WORK

**MANDATORY CHECKLIST** (5 minutes):

- [ ] **Step 1**: Check `@00_MASTER_RULE_HIERARCHY.mdc` for rule precedence
- [ ] **Step 2**: Review `@development/00_BROWNFIELD_FIRST_MANDATORY.mdc` for Phase 0 requirements
- [ ] **Step 3**: Use BMAD-Cloud MCP to query KG/RAG for existing implementations
- [ ] **Step 4**: Map cross-repository dependencies (cerebral/, cerebral-deployment/, KG/RAG)
- [ ] **Step 5**: Make build vs. integrate decision with justification

**You cannot proceed without Phase 0 complete.**

---

## ðŸ“š RULE PRECEDENCE (When Rules Conflict)

**Quick version:**

```
PRIORITY 0 wins over everything else (Constitutional rules)
  â†“ These can only be overridden by other P0 rules
PRIORITY 1 wins over 2, 3, 4 (Foundational rules)
  â†“ These implement Constitutional principles
PRIORITY 2 wins over 3, 4 (Operational rules)
  â†“ These implement Foundational rules
PRIORITY 3 wins over 4 (Contextual language/framework rules)
PRIORITY 4 (Advisory - best practices)
```

**In practice:**

| Question | Answer |
|----------|--------|
| "Can I use mock objects?" | NO - VEG Framework (P1) prohibits them |
| "Where do docs go?" | docs/ directory - Master Docs (P0) requires it |
| "Which Supabase method?" | client.rpc("run_sql", {...}) - Authoritative (P2) method |
| "Do I need Phase 0?" | YES - Brownfield-First (P1) mandatory, no exceptions |
| "Should I check existing code?" | YES - RAG Usage (P1) requires it before coding |

---

## ðŸŒ PHASE 0 BROWNFIELD ANALYSIS

**What**: Mandatory analysis before ANY planning/coding
**When**: Before every feature, bug fix, architecture change
**Who**: All agents, no exceptions
**Time**: 30-90 minutes (depending on scope)

### Quick Phase 0 Workflow

```
1. QUERY KG/RAG (10 minutes)
   mcp_bmad-cloud_bmad_analyst task="Find existing implementations of [feature]"
   mcp_bmad-cloud_bmad_architect task="What is current architecture for [component]?"

2. SCAN REPOS (15 minutes)
   - cerebral/ â†’ backend_python/, microservices/
   - cerebral-deployment/ â†’ kubernetes/, tekton/
   - Supabase â†’ schema, functions

3. MAP DEPENDENCIES (10 minutes)
   - List all existing implementations
   - Document integration paths
   - Identify cross-repo dependencies

4. DECIDE (5 minutes)
   Build new: Why existing won't work? [reason]
   Integrate: How to integrate existing? [effort]
   Hybrid: What build, what integrate? [plan]

5. DOCUMENT (5 minutes)
   Complete Phase 0 template (in brownfield-first rule)
```

### Phase 0 Template (Copy & Complete)

```markdown
# Phase 0 Analysis - [Feature Name]

## KG/RAG Queries
- Query 1: [what I searched]
  Result: [what I found]

- Query 2: [what I searched]
  Result: [what I found]

## Existing Implementations
- Implementation 1: [path, status, complexity]
- Implementation 2: [path, status, complexity]

## Cross-Repository Dependencies
- Dependency 1: [repo, impact]
- Dependency 2: [repo, impact]

## Decision: Build / Integrate / Hybrid
[Your chosen approach with justification]

## Effort Estimate
- Integration paths: X hours
- New code: Y hours
- Testing: Z hours
```

---

## ðŸš« COMMON MISTAKES TO AVOID

| âŒ WRONG | âœ… RIGHT |
|---------|---------|
| Plan without Phase 0 | Complete Phase 0 first, then plan |
| Assume nothing exists | Query KG/RAG for existing code |
| Build new from scratch | Check for integration paths |
| Use mock/fake code | Implement real functionality |
| Add TODOs to commit | Implement complete solution |
| Store docs in root | Put all docs in docs/ subdirectories |
| Write .md files directly | Use AutoDoc service for documentation |
| Skip validation | Run validation script before pushing |

---

## ðŸ“ž WHEN TO REFERENCE WHAT

| Need | Reference |
|------|-----------|
| "Which rule applies?" | `00_MASTER_RULE_HIERARCHY.mdc` |
| "Do I need Phase 0?" | `development/00_BROWNFIELD_FIRST_MANDATORY.mdc` |
| "How to query Supabase?" | `development/03_SUPABASE_OPERATIONS_AUTHORITATIVE.mdc` |
| "Production standards?" | `core/01_PRODUCTION_STANDARDS.mdc` |
| "File organization?" | `development/00_MASTER_DOCUMENTATION_STANDARDS.mdc` |
| "How to handle conflicts?" | `00_MASTER_RULE_HIERARCHY.mdc` â†’ CONFLICT_RESOLUTION_ALGORITHM |
| "Enterprise patterns?" | `.trae/rules/enterprise_methodology.md` |
| "Full solution details?" | `docs/01-DEPLOYMENT/framework-audit-rules-enforcement-complete.md` |

---

## âœ… VALIDATION CHECKLIST

Before committing code, verify:

```bash
â–¡ Rule Compliance
  â”œâ”€ No mock/fake/placeholder code
  â”œâ”€ No TODOs in production code
  â”œâ”€ All imports from shared library (not duplicates)
  â””â”€ Type hints on all functions

â–¡ Brownfield Context
  â”œâ”€ Phase 0 analysis completed
  â”œâ”€ KG/RAG queries documented
  â”œâ”€ Existing implementations leveraged
  â””â”€ Build vs. integrate decision justified

â–¡ Documentation
  â”œâ”€ .md files in docs/ (not root)
  â”œâ”€ Proper naming: action-subject-scope.md
  â”œâ”€ Category correct (01-07)
  â””â”€ Navigation links updated

â–¡ Testing
  â”œâ”€ Unit tests written
  â”œâ”€ Integration tests for external deps
  â”œâ”€ Performance tests if >10s
  â””â”€ >85% code coverage
```

---

## ðŸ”„ TYPICAL AGENT WORKFLOW

```
1. RECEIVE TASK
   â†“
2. PHASE 0 ANALYSIS (mandatory)
   â”œâ”€ Query KG/RAG
   â”œâ”€ Scan repositories
   â”œâ”€ Document findings
   â””â”€ Decide build vs. integrate
   â†“
3. REFERENCE RULES
   â”œâ”€ Check Master Hierarchy
   â”œâ”€ Identify applicable P0-P1 rules
   â”œâ”€ Review compliance requirements
   â””â”€ Note any conflicts
   â†“
4. PLAN IMPLEMENTATION
   â”œâ”€ Use existing code where possible
   â”œâ”€ Follow enterprise patterns
   â”œâ”€ Design for compliance
   â””â”€ Document approach
   â†“
5. IMPLEMENT CODE
   â”œâ”€ Follow VEG framework (no theater)
   â”œâ”€ Write comprehensive tests
   â”œâ”€ Add structured logging
   â”œâ”€ Use circuit breaker patterns
   â””â”€ Full error handling
   â†“
6. VALIDATE
   â”œâ”€ Run validation script
   â”œâ”€ Fix all violations
   â”œâ”€ Check rule compliance
   â”œâ”€ Verify documentation
   â””â”€ Test extensively
   â†“
7. COMMIT & PUSH
   â”œâ”€ Clear commit message
   â”œâ”€ Reference rules/memories
   â”œâ”€ Link to task
   â””â”€ Push to develop
```

---

## ðŸŽ¯ FIRST-TIME SUCCESS FACTORS

To achieve 90-95% first-pass success (up from 40-50%):

1. âœ… **Phase 0 is mandatory** - 100% platform context before planning
2. âœ… **Rules are clear** - Master hierarchy eliminates conflicts
3. âœ… **Code is real** - VEG framework prohibits theater
4. âœ… **Architecture is enterprise** - SRP, DI, monitoring, circuit breakers
5. âœ… **Testing is comprehensive** - >85% coverage, all scenarios
6. âœ… **Compliance is built-in** - SOC2/HIPAA/GDPR/ISO27001/PCI from start
7. âœ… **Validation is automated** - Catches gaps immediately

---

## ðŸ“Œ KEY PHRASES TO REMEMBER

- **"Phase 0 first"** - Always start with brownfield analysis
- **"Query KG/RAG"** - Before any coding, check what exists
- **"Build vs. integrate"** - Every feature needs this decision
- **"P0 rules win"** - When in doubt, check Constitutional level
- **"Real functionality"** - No mocks, theater, or TODOs
- **"Enterprise patterns"** - SRP, DI, monitoring, circuit breaker
- **"Comprehensive validation"** - Commit script catches gaps

---

## ðŸš¨ IMMEDIATE ACTION

### RIGHT NOW:
1. âœ… Read this quick reference (5 min)
2. âœ… Reference `.cursor/rules/00_MASTER_RULE_HIERARCHY.mdc` (5 min)
3. âœ… Bookmark `.cursor/rules/development/00_BROWNFIELD_FIRST_MANDATORY.mdc` (quick reference for Phase 0)

### BEFORE YOUR NEXT TASK:
1. âœ… Complete Phase 0 analysis (30-90 min, depending on scope)
2. âœ… Use BMAD-Cloud MCP to query KG/RAG
3. âœ… Map existing implementations
4. âœ… Make build vs. integrate decision
5. âœ… Document everything
6. âœ… Proceed to planning with 100% context

### AFTER IMPLEMENTATION:
1. âœ… Run validation script
2. âœ… Fix any violations
3. âœ… Commit with clear message
4. âœ… Push to develop

---

**This framework audit solution ensures first-time success through mandatory brownfield analysis, explicit rule hierarchy, and automated validation. No more gap-fill sessions.**

**Start with Phase 0. Always. No exceptions.**
