---
description: Tool usage protocols (agent-select). Use when guidance on tool ordering is needed.
globs:
alwaysApply: false
---
# ğŸ› ï¸ TOOL USAGE PROTOCOLS

## ğŸš¨ MANDATORY TOOL SELECTION HIERARCHY

### **TIER 1: REQUIRED TOOLS (Use First)**

#### **ğŸ§  AutoDoc RAG System (PRIMARY)**
```bash
# ALWAYS USE FIRST for any code/documentation search
tsx .cerebral/rag/rag-enhanced-query.ts search "your query"
tsx .cerebral/rag/rag-enhanced-query.ts status
```

**Use for:**
- Finding existing implementations
- Understanding architectural patterns
- Locating specific code examples
- Documentation research
- Component discovery
- Service pattern analysis

#### **ğŸ“ File Operations (When Specific Files Known)**
```bash
read_file           # When you know exact file path from RAG results
edit_file           # For making changes to known files
search_replace      # For precise edits in large files
```

#### **ğŸ—ï¸ Supabase MCP Tools (Database Operations)**
```bash
mcp_supabase_execute_sql      # Database queries
mcp_supabase_apply_migration  # Schema changes
mcp_supabase_list_tables      # Schema discovery
```

### **TIER 2: CONDITIONAL TOOLS (Use Only When Needed)**

#### **ğŸ“‚ Directory Exploration (Discovery Only)**
```bash
list_dir           # Only for initial project exploration
file_search        # Only when RAG results don't provide file paths
```

#### **âš¡ Terminal Commands (Specific Operations)**
```bash
run_terminal_cmd   # For npm commands, builds, tests
                  # NOT for code searching
```

### **TIER 3: FORBIDDEN TOOLS (NEVER USE)**

#### **ğŸš« ABSOLUTELY PROHIBITED**
```bash
grep_search        # âŒ NEVER - Use RAG instead
git commands       # âŒ NEVER - Use RAG for code discovery
find commands      # âŒ NEVER - Use RAG for file discovery
ripgrep/rg         # âŒ NEVER - Use RAG for pattern search
```

## ğŸ”„ CORRECT WORKFLOW PATTERN

### **âœ… RAG-First Pattern (REQUIRED)**
```
1. ğŸ§  RAG SEARCH: tsx .cerebral/rag/rag-enhanced-query.ts search "topic"
2. ğŸ“‹ ANALYZE: Review RAG results for patterns and file locations
3. ğŸ“ READ FILES: Use read_file for specific files found in RAG
4. ğŸ’» IMPLEMENT: Make changes using edit_file/search_replace
5. âœ… VERIFY: Cross-reference with RAG findings
```

### **âŒ Anti-Pattern (FORBIDDEN)**
```
1. ğŸš« grep_search "pattern"     # Wrong - use RAG
2. ğŸš« find . -name "*.ts"       # Wrong - use RAG
3. ğŸš« git grep "search"         # Wrong - use RAG
4. ğŸš« Manual file browsing      # Wrong - use RAG
```

## ğŸ“Š TOOL SELECTION DECISION TREE

```
Need to find code/docs?
â”œâ”€â”€ YES â†’ Use RAG: tsx .cerebral/rag/rag-enhanced-query.ts search "query"
â””â”€â”€ NO â†’ Continue to next question

Know exact file path?
â”œâ”€â”€ YES â†’ Use read_file
â””â”€â”€ NO â†’ Use RAG first to find file path

Need to modify code?
â”œâ”€â”€ Small change â†’ Use search_replace
â”œâ”€â”€ Large change â†’ Use edit_file
â””â”€â”€ Database change â†’ Use mcp_supabase_*

Need to run commands?
â”œâ”€â”€ Build/test â†’ Use run_terminal_cmd
â”œâ”€â”€ Database â†’ Use mcp_supabase_*
â””â”€â”€ Search â†’ Use RAG (not terminal commands)
```

## ğŸ¯ SPECIFIC USE CASES

### **Authentication Implementation**
```bash
# âœ… CORRECT
tsx .cerebral/rag/rag-enhanced-query.ts search "OAuth authentication implementation"
tsx .cerebral/rag/rag-enhanced-query.ts search "auth service patterns"

# âŒ WRONG
grep_search "auth"
find . -name "*auth*"
```

### **Database Schema Research**
```bash
# âœ… CORRECT
tsx .cerebral/rag/rag-enhanced-query.ts search "database schema organizations"
mcp_supabase_list_tables

# âŒ WRONG
grep_search "CREATE TABLE"
find . -name "*.sql"
```

### **Component Architecture**
```bash
# âœ… CORRECT
tsx .cerebral/rag/rag-enhanced-query.ts search "react component patterns"
tsx .cerebral/rag/rag-enhanced-query.ts search "lazy loading implementation"

# âŒ WRONG
grep_search "component"
find . -name "*Component*"
```

## ğŸ§  RAG SYSTEM ADVANTAGES

### **Why RAG Beats Traditional Search:**
- **ğŸ¯ Semantic Understanding**: Understands intent, not just keywords
- **ğŸ“Š Comprehensive Coverage**: 4,359 docs + 1,012 code chunks
- **âš¡ Pre-processed**: Instant results vs slow grep operations
- **ğŸ”„ Always Current**: Auto-syncs with latest changes
- **ğŸ§© Context Aware**: Returns relevant patterns and examples
- **ğŸš€ AI-Powered**: OpenAI embeddings for intelligent matching

### **RAG vs Traditional Tools:**
```
Traditional: grep_search "authentication"
â†’ Returns raw text matches, no context

RAG: tsx .cerebral/rag/rag-enhanced-query.ts search "authentication"
â†’ Returns:
  - Relevant auth implementations
  - Architecture documentation
  - Security patterns
  - Integration examples
  - Best practices
```

## ğŸš¨ ENFORCEMENT

### **Required Evidence:**
Every code suggestion must include:
1. **RAG Search Command Used**: `tsx .cerebral/rag/rag-enhanced-query.ts search "topic"`
2. **RAG Results Summary**: Key findings from search
3. **Pattern Justification**: How implementation follows RAG findings

### **Violations:**
- Using `grep_search` instead of RAG â†’ Immediate correction required
- Using `find` for code discovery â†’ Must use RAG instead
- Manual file browsing â†’ Must query RAG first
- Git commands for search â†’ Must use RAG system

---

**The AutoDoc RAG system is your primary tool for code discovery and understanding. All other tools are secondary and support the RAG-driven development workflow.**

*Priority: CRITICAL - Tool selection affects development efficiency and code quality*
