# ğŸ—ï¸ CEREBRAFLOW ARCHITECTURE LAYERS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CURSOR AI LAYER                      â”‚
â”‚  - MCP Tools (12 consolidated tools)                   â”‚
â”‚  - Quick Reference Rules                               â”‚
â”‚  - Memory System Integration                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 CEREBRAFLOW MCP LAYER                   â”‚
â”‚  - .cerebraflow/core/mcp/cerebraflow_server.py        â”‚
â”‚  - Task Management (task_handlers.py)                  â”‚
â”‚  - Research Integration (research_handlers.py)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UNIFIED STORAGE LAYER                â”‚
â”‚  - MCPUnifiedStorage (ChromaDB + Supabase sync)       â”‚
â”‚  - Tenant Isolation                                   â”‚
â”‚  - Enterprise Security                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PRODUCTION DATA LAYER                â”‚
â”‚  - Supabase (Production Database)                     â”‚
â”‚  - ChromaDB (Local Cache)                            â”‚
â”‚  - AutoDoc RAG (4,527 chunks)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ INTEGRATION FLOW
1. **RAG Query** â†’ `mcp_cerebraflow-stdio_research`
2. **Task Operations** â†’ `TaskManager` â†’ `MCPUnifiedStorage`
3. **Data Persistence** â†’ `ChromaDB` â†’ `Supabase` (sync)
4. **Enterprise Validation** â†’ Real implementations only

## ğŸ“ CRITICAL DIRECTORY STRUCTURE

```
/Users/bbaer/Development/Cerebral/
â”œâ”€â”€ .cerebraflow/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ mcp/
â”‚   â”‚   â”‚   â”œâ”€â”€ cerebraflow_server.py         # Main MCP server
â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ task_handlers.py          # Task operations
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ research_handlers.py      # RAG operations
â”‚   â”‚   â”‚   â””â”€â”€ core/
â”‚   â”‚   â”‚       â””â”€â”€ task_manager.py           # Core task logic
â”‚   â”‚   â””â”€â”€ storage/
â”‚   â”‚       â””â”€â”€ mcp_unified_storage.py        # Unified storage
â”‚   â””â”€â”€ validation/
â”‚       â””â”€â”€ enterprise_pattern_validator.py   # Compliance validator
â”œâ”€â”€ autodoc/
â”‚   â””â”€â”€ rag/
â”‚       â””â”€â”€ chunks/                           # 4,527 RAG files
â”œâ”€â”€ backend-python/
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ memory/                           # Memory services
â””â”€â”€ src/                                      # Frontend React app
```

## ğŸ› ï¸ MCP TOOL REFERENCE

### **Core Tools (Use These)**
- `mcp_cerebraflow-stdio_research` - RAG queries (USE FIRST)
- `mcp_cerebraflow-stdio_task_query` - List/get tasks
- `mcp_cerebraflow-stdio_task_modify` - Create/update tasks
- `mcp_cerebraflow-stdio_system` - System operations

### **Enterprise Tools**
- `mcp_cerebraflow-stdio_code_quality` - Code validation
- `mcp_cerebraflow-stdio_compliance_workflow` - SOC2/HIPAA compliance

## ğŸ¯ INTEGRATION PATTERNS

### **Task Management Integration:**
```python
# Import pattern
from .cerebraflow.core.mcp.core.task_manager import TaskManager
from .cerebraflow.core.mcp.direct_mcp_client import DirectMCPClient

# Usage pattern
task_manager = TaskManager()
result = await task_manager.create_task(task_data, tenant_id="...")
```

### **RAG Integration Pattern:**
```python
# Always use MCP tool first
result = await mcp_cerebraflow_research({
    "query": "specific implementation pattern",
    "limit": 5
})
```

### **Storage Integration Pattern:**
```python
# Unified storage for all data operations
from .cerebraflow.core.storage.mcp_unified_storage import MCPUnifiedStorage

storage = MCPUnifiedStorage()
await storage.store_with_tenant_isolation(data, tenant_id)
```

## ğŸš¨ CRITICAL ARCHITECTURE RULES

1. **RAG FIRST**: Always query knowledge before implementation
2. **TENANT ISOLATION**: Every operation must include tenant_id
3. **ENTERPRISE COMPLIANCE**: Zero tolerance for mock/fake code
4. **UNIFIED STORAGE**: Single source of truth for all data
5. **MCP INTEGRATION**: Use direct MCP client for all operations

---

**This architecture ensures enterprise-grade, compliant, and efficient implementations on first attempt.**
