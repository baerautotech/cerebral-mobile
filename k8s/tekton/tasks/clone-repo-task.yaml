apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: cerebral-mobile-clone-repo
  namespace: tekton-pipelines
  labels:
    app: cerebral-mobile
    component: git
spec:
  description: Clone the cerebral-mobile repo into a deterministic subdirectory (repo/) in the shared workspace.
  params:
    - name: repo-url
      type: string
      description: Git repository URL
    - name: repo-branch
      type: string
      default: main
      description: Git branch to clone
  workspaces:
    - name: output
      description: Workspace where the repo will be cloned
  steps:
    - name: clone
      image: alpine/git:latest
      workingDir: $(workspaces.output.path)
      script: |
        #!/bin/sh
        set -e
        echo "ðŸ”„ Cloning repository into $(workspaces.output.path)/repo ..."
        rm -rf repo
        git clone -b $(params.repo-branch) $(params.repo-url) repo
        cd repo
        echo "âœ… Repository cloned"
        echo "Branch: $(git rev-parse --abbrev-ref HEAD)"
        echo "Commit: $(git rev-parse HEAD)"
